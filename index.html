<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Character with Enhanced Jump Effect</title>
  <style>
    body, html {
      margin: 0;
      height: 100%;
      overflow: hidden;
    }

    #card {
      display: none; /* Default to not displayed */
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%)scale(0.5);
      z-index: 1000; /* Make sure this is higher than other elements */
      background-color: white;
      border: 1px solid black;
      padding: 20px;
      width: auto; /* Adjust as necessary */
      height: auto; /* Adjust as necessary */
      max-width: 80%; /* Prevent the image from being too large */
      max-height: 80%; /* Prevent the image from being too large */
      overflow: hidden; /* Hide the overflow */
      animation: rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; /* 使用 cubic-bezier 函数 */
    }
    #card img {
      width: 100%; /* Adjust the image to the container width */
      height: auto; /* Adjust the image height automatically */
    }
    #game-board {
      position: relative;
      width: 5%;
      height: 5%;
      /* background-image: url('https://github.com/vita-cpu/Pradaproject/blob/main/%E6%A3%8B%E7%9B%98%E6%9B%B4%E6%96%B0_00.png?raw=true');
      background-position: center;
      background-repeat: no-repeat;
      background-size: contain; */
    }

    @media screen and (max-width: 600px) {
      .image-container img {
        transform: scale(5); /* 将图片放大5倍 */
      }
    }

    @keyframes rotateCard {
      0% {
        transform: translate(-50%, -50%) scale(0.3) rotate(0deg);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(0.5) rotate(360deg);
        opacity: 1;
      }
    }

    .character {
      position: absolute;
      top: 0;
      left: 0;
      width: 2%;
      cursor: pointer;
      transition: left 0.5s, top 0.5s;
    }

    @keyframes jump {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5%); } /* Increased jump height */
    }

    .jumping {
      animation: jump 0.6s ease-out;
    }

    .image-container {
      /* left:10%; */
      padding-left: 20%;
      padding-top: 10%;
      width: 60%; /* 设置div的宽度为100% */
      height: 60%; /* 设置div的高度为视口的高度，以充满屏幕 */
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden; /*隐藏溢出的部分*/
    }

    .image-container img {
      max-width: 100%; /* 图片最大宽度为100% */
      max-height: 100%; /* 图片最大高度为100% */
      width: auto; /* 自动调整宽度 */
      height: auto; /*自动调整高度*/
    }

  </style>
</head>
<body>
<div id="card">
  <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E5%8D%A1%E7%89%87.png?raw=true'" alt="Displayed Image" /> <!-- 示例图片，您可以替换为您希望显示的图片 -->
</div>
<div class="image-container" id="image_container">
  <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E9%99%8D%E8%90%BD%E4%BC%9E-%E6%A9%99.png?raw=true" alt="Character Icon"
       class="character" id="character" style="width: 2%; z-index:1;">
  <div style="position: relative;">
    <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E6%A3%8B%E7%9B%98%E6%9B%B4%E6%96%B0_00.png?raw=true" alt="Your Image">
    <div style="position:absolute;left:2%;top:3.3%;width:96%;height: 82.3%;" id="block">
      <!-- 这里是说明格子 -->
      <div style="position:absolute;left:0%;top:0%;width:12.5%;height: 60%;" id="instruction">
      </div>
      <!--x 说明格子结束 x-->

      <!-- 这里开始是第1行的格子 -->
      <div style="position:absolute;left:12.5%;top:0%;width:25%;height: 20%;" id="logo">
      </div>
      <!-- B表示Block格子，B_Start表示 Start 这个格子；同理 B_O表示字母为O的格子 -->
      <div style="position:absolute;left:37.5%;top:0%;width:12.5%;height: 20%;" id="B_Start">
      </div>

      <div style="position:absolute;left:50%;top:0%;width:12.5%;height: 20%;" id="B_O">
      </div>
      <div style="position:absolute;left:62.5%;top:0%;width:12.5%;height: 20%;" id="B_Q">
      </div>
      <div style="position:absolute;left:75%;top:0%;width:12.5%;height: 20%;" id="B_C">
      </div>
      <div style="position:absolute;left:87.5%;top:0%;width:12.5%;height: 20%;" id="B_Pass">
      </div>
      <!--x 第1行的格子结束 x-->


      <!-- 这里开始是第2行的格子 -->
      <div style="position:absolute;left:12.5%;top:20%;width:12.5%;height: 20%;" id="B_K">
      </div>
      <div style="position:absolute;left:25%;top:20%;width:12.5%;height: 20%;" id="B_X">
      </div>
      <div style="position:absolute;left:37.5%;top:20%;width:12.5%;height: 20%;" id="B_W">
      </div>
      <div style="position:absolute;left:50%;top:20%;width:12.5%;height: 20%;" id="B_Pass2">
      </div>
      <div style="position:absolute;left:62.5%;top:20%;width:12.5%;height: 20%;" id="B_N">
      </div>
      <div style="position:absolute;left:75%;top:20%;width:12.5%;height: 20%;" id="B_I">
      </div>
      <div style="position:absolute;left:87.5%;top:20%;width:12.5%;height: 20%;" id="B_G">
      </div>
      <!--x 第2行的格子结束 x-->

      <!-- 这里开始是第3行的格子 -->
      <div style="position:absolute;left:12.5%;top:40%;width:12.5%;height: 20%;" id="B_Pass3">
      </div>
      <div style="position:absolute;left:25%;top:40%;width:12.5%;height: 20%;" id="B_Y">
      </div>
      <div style="position:absolute;left:37.5%;top:40%;width:12.5%;height: 20%;" id="B_J">
      </div>
      <div style="position:absolute;left:50%;top:40%;width:12.5%;height: 20%;" id="B_E">
      </div>
      <div style="position:absolute;left:62.5%;top:40%;width:12.5%;height: 20%;" id="B_Choose3">
      </div>
      <div style="position:absolute;left:75%;top:40%;width:12.5%;height: 20%;" id="B_F">
      </div>
      <div style="position:absolute;left:87.5%;top:40%;width:12.5%;height: 20%;" id="B_S">
      </div>
      <!--x 第3行的格子结束 x-->

      <!-- 这里开始是第4行的格子 -->
      <div style="position:absolute;left:0%;top:60%;width:12.5%;height: 20%;" id="B_U">
      </div>
      <div style="position:absolute;left:12.5%;top:60%;width:12.5%;height: 20%;" id="B_L">
      </div>
      <div style="position:absolute;left:25%;top:60%;width:12.5%;height: 20%;" id="B_Choose4">
      </div>
      <div style="position:absolute;left:37.5%;top:60%;width:12.5%;height: 20%;" id="B_V">
      </div>
      <div style="position:absolute;left:50%;top:60%;width:12.5%;height: 20%;" id="B_P">
      </div>
      <div style="position:absolute;left:62.5%;top:60%;width:12.5%;height: 20%;" id="B_A">
      </div>
      <div style="position:absolute;left:75%;top:60%;width:12.5%;height: 20%;" id="B_R">
      </div>
      <div style="position:absolute;left:87.5%;top:60%;width:12.5%;height: 20%;" id="B_H">
      </div>
      <!--x 第4行的格子结束 x-->

      <!-- 这里开始是第5行的格子 -->
      <div style="position:absolute;left:0%;top:80%;width:12.5%;height: 20%;" id="B_D">
      </div>
      <div style="position:absolute;left:12.5%;top:80%;width:12.5%;height: 20%;" id="B_B">
      </div>
      <div style="position:absolute;left:25%;top:80%;width:12.5%;height: 20%;" id="B_M">
      </div>
      <div style="position:absolute;left:37.5%;top:80%;width:12.5%;height: 20%;" id="B_T">
      </div>
      <div style="position:absolute;left:50%;top:80%;width:12.5%;height: 20%;" id="B_Z">
      </div>
      <div style="position:absolute;left:62.5%;top:80%;width:12.5%;height: 20%;" id="B_End">
      </div>
      <div style="position:absolute;left:75%;top:80%;width:25%;height: 20%;" id="B_Ans">
      </div>
      <!--x 第5行的格子结束 x-->

    </div>
  </div>
</div>


<script>

  //这里加了事件监听
  document.addEventListener('DOMContentLoaded', function () {

//这里加了事件监听,关于卡片的效果的
    var card = document.getElementById('card');

    document.getElementById('B_Start').addEventListener('click', function() {
      var card = document.getElementById('card');
      card.style.display = 'block'; // 显示卡片
      card.style.animation = 'rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards'; // 应用动画
    });


    // 隐藏卡片时移除动画
    card.addEventListener('click', function() {
      card.style.display = 'none';
      card.style.animation = 'none'; // 移除动画
    });
  });



  //这里是控制边缘线啥的，限制移动的代码
  document.addEventListener('DOMContentLoaded', function() {
    var character = document.getElementById('character');

    // 判断是否可以越过上下边界
    function canCrossBoundary(cellId) {
      //  return ['B_Pass', 'B_G', 'B_Pass3', 'B_K', 'B_F', 'B_U', 'B_R', 'B_D'].includes(cellId);
      return ['B_Pass', 'B_K', 'B_S', 'B_U'].includes(cellId);
    }

    function canCrossBoundary2(cellId) {
      return [ 'B_G', 'B_Pass3', 'B_H', 'B_D'].includes(cellId);
    }



    // 处理角色移动
    function handleCharacterMove(event) {
      var map_array=[["B_Start","B_O","B_Q","B_C","B_Pass"],
        ["B_G","B_I","B_N","B_Pass2","B_W","B_X","B_K"],
        ["B_Pass3","B_Y","B_J","B_E","B_Choose3","B_F","B_S"],
        ["B_H","B_R","B_A","B_P","B_V","B_Choose4","B_L","B_U"],
        ["B_D","B_B","B_M","B_T","B_Z","B_End","B_Ans"]]
      var target = event.target;
      if (!target.id.startsWith('B_')) return; // 忽略非 B_ 开头的元素

      var currentCellId = character.getAttribute('data-current-cell') || 'B_Start';
      var targetCellId = target.id;

      var mouseX = event.clientX; // 水平坐标
      var mouseY = event.clientY; // 垂直坐标



      //  var message = "currentCellId：" + currentCellId + "\n targetCellId：" + targetCellId;
      //  alert(message);

      var findElementPosition=function (twoDArray, target)
      {
        var order=0
        for (let i = 0; i < twoDArray.length; i++) { // 遍历每一行
          for (let j = 0; j < twoDArray[i].length; j++) { // 遍历每一行的每一列
            order=order+1
            if (twoDArray[i][j] === target) {
              return { row: i, col: j,order:order }; // 找到目标，返回位置
            }
          }
        }
        return null; // 如果没有找到目标，返回null
      }
      var position_currentCell=findElementPosition(map_array,currentCellId)
      var position_targetCell=findElementPosition(map_array,targetCellId)
      // var message = "currentCellId：" + currentCellId + "\n targetCellId：" + targetCellId+"\n"+position_currentCell.row+"\n"+position_targetCell.row+"\n"+position_targetCell.order;
      // alert(message);

      var PassCheck = function() {
        if (targetCellId=="B_Pass"){
          alert("恭喜你打开传送门！向前前进一格")
          var B_G = document.getElementById("B_G");

          var x = B_G.getBoundingClientRect().left + window.scrollX + (B_G.getBoundingClientRect().width - character.offsetWidth) / 2;
          var y = B_G.getBoundingClientRect().top + window.scrollY + (B_G.getBoundingClientRect().height - character.offsetHeight) / 2;
          moveCharacterTo2(x, y,targetCellId);

          character.setAttribute('data-current-cell', "B_G");

        }
        if (targetCellId=="B_Pass3"){
          alert("恭喜你打开传送门！向前前进两格")
          var B_J = document.getElementById("B_J");

          var x = B_J.getBoundingClientRect().left + window.scrollX + (B_J.getBoundingClientRect().width - character.offsetWidth) / 2;
          var y = B_J.getBoundingClientRect().top + window.scrollY + (B_J.getBoundingClientRect().height - character.offsetHeight) / 2;
          character.setAttribute('data-current-cell', "B_J");
          moveCharacterTo2(x, y,targetCellId);
        }
      }
      var finalMove = function() {
        // 计算点击位置
        var rect = target.getBoundingClientRect();
        // var x = rect.left + window.scrollX + (rect.width - character.offsetWidth) / 2;
        // var y = rect.top + window.scrollY + (rect.height - character.offsetHeight) / 2;
        var x = mouseX-character.offsetWidth;
        var y = mouseY-character.offsetHeight;
        var res1= position_currentCell.row -position_targetCell.row; // 计算是否处在同一行
        var res2=position_targetCell.order-position_currentCell.order; //计算是否能穿梭
        // var message = "x: " + x+" y:" + y + "\n x2: " + x2+"y2: "+y2+"\n now_x: "+character.style.left+" now_y: "+character.style.top;
        // alert(message);

        //  res1=0表示没有跨行 res1!=0表示跨行了
        if(res1!=0){ //跨行了
          if (res2==-1){ //跨行且能到上一行
            moveCharacterTo(x, y,targetCellId);
            character.setAttribute('data-current-cell', targetCellId);
          }
            // alert( position_currentCell.row,"-",position_targetCell.row, "-",res1)
          // if ((canCrossBoundary(currentCellId)&canCrossBoundary2(targetCellId))&((currentCellId!="B_Pass")|(targetCellId!="B_Pass3"))){
          else if ((res2==1)){ //跨行且能到下一行
            moveCharacterTo(x, y,targetCellId,function(){
              PassCheck();
            });
            character.setAttribute('data-current-cell', targetCellId);
          }
          else{ //跨行且不能穿梭
            // alert("currentCellId：" + currentCellId + "\n targetCellId：" + targetCellId);
            // alert( position_currentCell.row,"-",position_targetCell.row, "-",res1);
            alert("无法进行该移动");
            bounceCharacter(3, 600); // 碰撞时弹跳三次，每次弹跳600毫秒
          }
        }else{// 没有跨行
          if (res2<0){ //没有跨行，往回走，不会再次触发传送门
            moveCharacterTo(x, y,targetCellId);
            character.setAttribute('data-current-cell', targetCellId);
          }else{
            moveCharacterTo(x, y,targetCellId,function(){
              PassCheck()
            });
            character.setAttribute('data-current-cell', targetCellId);
          }
        }
      }

      finalMove();
    };


    function bounceCharacter(times, duration) {
      let count = 0;
      let interval = setInterval(() => {
        if (count >= times) {
          clearInterval(interval); // 达到弹跳次数后停止
          character.classList.remove('jumping'); // 移除弹跳类
        } else {
          character.classList.add('jumping'); // 添加弹跳类
          setTimeout(() => character.classList.remove('jumping'), duration / 2); // 半途移除弹跳类以完成一次弹跳
        }
        count++;
      }, duration);
    }

    // 为每个格子添加点击事件监听
    document.querySelectorAll('[id^="B_"]').forEach(function(cell) {
      cell.addEventListener('click', handleCharacterMove);
    });

    // 计算并更新角色位置

    function moveCharacterTo(x, y, targetCellId,callback) {
      // if(['B_Pass', 'B_Pass3'].includes(targetCellId)){
      //   character.style.display='none';
      //  character.style.left = x + 'px';
      //  character.style.top = y + 'px';
      //  character.classList.add('jumping');
      //  setTimeout(function() {
      //      character.classList.remove('jumping');
      //      character.style.display='block';
      //      if (callback) {
      //          callback();
      //      }
      //  }, 1);
      //  return;
      // }
      var startX = parseInt(character.style.left, 10) || 0;
      var startY = parseInt(character.style.top, 10) || 0;
      var endX = x;
      var endY = y;

      // 计算每一段的位移
      var deltaX = (endX - startX) / 7;
      var deltaY = (endY - startY) / 7;

      //  character.style.left = x + 'px';
      //  character.style.top = y + 'px';
      character.classList.add('jumping');
      for (let i = 1; i <= 7; i++) {
        setTimeout(function() {
          var nextX = startX + deltaX * i;
          var nextY = startY + deltaY * i;
          character.style.left = nextX + 'px';
          character.style.top = nextY + 'px';
          character.classList.add('jumping'); // 开始跳动
        }, i * 600); // 调整每段的延迟时间
        setTimeout(function() {
          character.classList.remove('jumping');
        }, 1);
      }
      setTimeout(function() {
        character.classList.remove('jumping');
        if (callback) {
          callback();
        }
      }, 5000);
    };

    function moveCharacterTo2(x, y, targetCellId,callback) {
      character.style.display='none';
      character.style.left = x + 'px';
      character.style.top = y + 'px';

      setTimeout(function() {
        character.style.display='block';
        if (callback) {
          callback();
        }
      }, 1);
      return;
    };


  });

</script>

</body>
</html>
