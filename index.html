<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Character with Enhanced Jump Effect</title>
  <style>
    body, html {
      margin: 0;
      height: 100%;
      overflow: auto;
    }

/*开始格子按钮的特效*/
     @property --border-angle-1 {
      syntax: "<angle>";
      inherits: true;
      initial-value: 0deg;
    }
    @property --border-angle-2 {
      syntax: "<angle>";
      inherits: true;
      initial-value: 90deg;
    }
    @property --border-angle-3 {
      syntax: "<angle>";
      inherits: true;
      initial-value: 180deg;
    }
    :root {
      --white: #fff;
      --background: #191816;
      --foreground: white;
      --border-size: 1px;
      --border-radius: .75em;
    }
    @keyframes rotateBackground {
      to { --border-angle-1: 360deg; }
    }
    @keyframes rotateBackground2 {
      to { --border-angle-2: -270deg; }
    }
    @keyframes rotateBackground3 {
      to { --border-angle-3: 540deg; }
    }
    #startButton {
      position: absolute;
      left: 50%;
      top: 80%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 26%;
      color: inherit;
      font-family: inherit;
      border: 0;
      padding: var(--border-size);
      border-radius: var(--border-radius);
      background-color: transparent;
      background-image: conic-gradient(from var(--border-angle-1) at 10% 15%, transparent, var(--white) 10%, transparent 30%, transparent),
      conic-gradient(from var(--border-angle-2) at 70% 60%, transparent, var(--white) 10%, transparent 60%, transparent),
      conic-gradient(from var(--border-angle-3) at 50% 20%, transparent, var(--white) 10%, transparent 50%, transparent);
      animation: rotateBackground 3s linear infinite,
      rotateBackground2 8s linear infinite,
      rotateBackground3 13s linear infinite;
    }
    #startButton div {
      background: var(--background);
      padding: 2.5em 1.8em;
      border-radius: calc(var(--border-radius) - var(--border-size));
      color: var(--foreground);
    }

    /* 保留原有关键帧动画定义 */

    #B_O button, #B_Q button, #B_C button {
      position: absolute;
      left: 50%;
      top: 87%;
      transform: translate(-50%, -50%);
      width: 90%; /* 确保与特效框宽度一致 */
      height: 26%; /* 确保与特效框高度一致 */
      color: inherit;
      font-family: inherit;
      border: 0;
      padding: var(--border-size);
      border-radius: var(--border-radius);
      background-color: transparent;
      background-image: conic-gradient(from var(--border-angle-1) at 10% 15%, transparent, var(--white) 10%, transparent 30%, transparent),
      conic-gradient(from var(--border-angle-2) at 70% 60%, transparent, var(--white) 10%, transparent 60%, transparent),
      conic-gradient(from var(--border-angle-3) at 50% 20%, transparent, var(--white) 10%, transparent 50%, transparent);
      animation: rotateBackground 3s linear infinite,
      rotateBackground2 8s linear infinite,
      rotateBackground3 13s linear infinite;
    }

    #B_O div, #B_C div {
      background: #79C38E; /* 设置为十六进制颜色 #79C38E */
      padding: 2.5em 1.5em;
      border-radius: calc(var(--border-radius) - var(--border-size));
      color: var(--foreground);
      font-size: 0.6em;
    }

    #B_Q div {
      background: var(--background); /* B_Q 保持原有的背景色 */
      padding: 2.5em 1.5em;
      border-radius: calc(var(--border-radius) - var(--border-size));
      color: var(--foreground);
      font-size: 0.6em;
    }
    /*按钮的特效更新*/
    /* 保留您之前定义的属性和动画 */
    /* ...您的现有 CSS代码... */

    /* B_End更新按钮样式以包含特效 */

    #B_End button {
      position: absolute;
      left: 50%;
      top: 40%;
      transform: translate(-50%, -50%);
      width: 100%; /* 调整宽度以适应 div */
      height: 100%; /* 调整高度以适应 div */
      border: 0;
      padding: var(--border-size);
      border-radius: var(--border-radius);
      background-color: transparent;
      background-image: conic-gradient(from var(--border-angle-1) at center, transparent, var(--white) 10%, transparent 30%, transparent),
      conic-gradient(from var(--border-angle-2) at center, transparent, var(--white) 10%, transparent 60%, transparent),
      conic-gradient(from var(--border-angle-3) at center, transparent, var(--white) 10%, transparent 50%, transparent);
      background-size: 100% 100%; /* 缩小特效框 */
      background-position: center; /* 特效框居中 */
      animation: rotateBackground 3s linear infinite,
      rotateBackground2 8s linear infinite,
      rotateBackground3 13s linear infinite;
    }

    #B_End button img {
      width: 50%; /* 或者根据您的需求调整 */
      height: 50%; /* 或者根据您的需求调整 */
      position: relative;
      top: 50%; /* 将图片居中 */
      left: 50%; /* 将图片居中 */
      transform: translate(-50%, -50%);
    }




    /*!*V13解决屏幕水平滑动的新特效*!*/
    /*#grid-container {*/
    /*  position: absolute;*/
    /*  transition: transform 0.3s ease; // Smooth transition for movement*/
    /*}*/


/*这里开始是卡片*/ 
/*修改4: 更改card的位置、比例，最好能把百分比和数字相关的内容，用vw vh设置，比如top, left, width, height这些。*/    
#card {
      display: none; /* Default to not displayed */
      position: fixed;
      top: 30vh;
      left: 45vw;
      transform: translate(-50%, -50%)scale(0.9);
      z-index: 1000; /* Make sure this is higher than other elements */
      background-color: white;
      border: 1px solid black;
      padding: 0px;
      width: 30vw; /* Adjust as necessary */
      height: auto; /* Adjust as necessary */
      max-width: 80vw; /* Prevent the image from being too large */
      max-height: auto; /* Prevent the image from being too large */
      overflow: hidden; /* Hide the overflow */
      animation: rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; /* 使用 cubic-bezier 函数 */
      justify-content: center;
      align-items: center;
      text-align: center;
      /* width: 30vw;height: 90vh; justify-content: center;align-items: center; */
    }
    #card img {
      width: 100%; /* Adjust the image to the container width */
      height: 100%; /* Adjust the image height automatically */
    }
    #game-board {
      position: relative;
      width: 5%;
      height: 5%;
      /* background-image: url('https://github.com/vita-cpu/Pradaproject/blob/main/%E6%A3%8B%E7%9B%98%E6%9B%B4%E6%96%B0_00.png?raw=true');
      background-position: center;
      background-repeat: no-repeat;
      background-size: contain; */
    }


    @keyframes rotateCard {
      0% {
        transform: translate(-50%, -50%) scale(0.3) rotate(0deg);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(0.5) rotate(360deg);
        opacity: 1;
      }
    }

    .character {
      position: absolute;
      top: 0;
      left: 0;
      width: 2%;
      cursor: pointer;
      transition: left 0.5s, top 0.5s;
    }

    @keyframes jump {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-30%); } /* Increased jump height */
    }

    .jumping {
      animation: jump 0.6s ease-out;
    }

    .image-container {
      /* padding-left: 10%; */
      width: 100%; /* 设置宽度为100% */
      height: auto; /* 高度自动调整 */
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: auto; /* 允许滚动 */
    }

    .image-container img {
      max-width: 100%; /* 图片最大宽度为100% */
      height: auto; /* 高度自动调整 */
    }






  </style>
</head>
<body>

<div class="image-container" id="image_container">
  <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E9%99%8D%E8%90%BD%E4%BC%9E-%E6%A9%99.png?raw=true" alt="Character Icon"
       class="character" id="character" style="width: 20vw; height:auto; z-index:1;">

  <div style="position: relative;width:700vw;height: 250vh;" id="whole_map">
    <div id="card">
      <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E5%8D%A1%E7%89%87.png?raw=true'" alt="Displayed Image" /> <!-- 示例图片，您可以替换为您希望显示的图片 -->
    </div>
    <!-- 修改1: 替换最新的地图 -->
    <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E8%AA%8C%E5%B1%8Bvol39_prada%E6%A3%8B%E7%9B%98.jpg?raw=true" alt="Your Image"> 
    <!-- # 修改2: 更改"left:2%;top:3.3%;width:96%;height: 82.7%;"这一堆数值，让它能完整切割整体格子 -->
    <div style="position:absolute;left:0%;top:0%;width:100%;height: 100%;" id="block">
      <!-- 这里开始是第1行的格子 -->
      <div style="position:absolute;left:0%;top:0%;width:28.57%;height:17.5%;" id="logo">
      </div>
      <!-- B表示Block格子，B_Start表示 Start 这个格子；同理 B_O表示字母为O的格子 -->
      <div style="position:absolute;left:28.57%;top:0%;width:14.29%;height:17.5%;" id="B_Start">
        <!-- # 修改3: 调整每个button，你可以仿照START这样去写。一般来说直接把文本放在button里面就行，不用另开div  -->
        <button id="startButton" class="flowing-light-effect" style="position: absolute; left: 50%; top: 84%; width: 80%; height: 24%;transform: translate(-50%, -50%);">
            <div>
                START
            </div>
        </button>

      </div>


      <div style="position:absolute;left:42.86%;top:0%;width:14.29%;height:17.5%;" id="B_O">
        <button id="button_O" class="flowing-light-effect" style="position: absolute; left: 50%; top: 89%; transform: translate(-50%, -50%); width: 90%; height: 18%;">
          <div>奥斯曼帝国在意大利败退,PRADA正式在米兰创立。<br>
            🔍检索PRADA PEDIA -ORIGINS</div>
      </div>
      <div style="position:absolute;left:57.14%;top:0%;width:14.29%;height:17.5%;" id="B_Q">
        <!-- B_Q button -->
        <button id="button_Q" class="flowing-light-effect" style="position: absolute; left: 50%; top: 89%; transform: translate(-50%, -50%); width: 90%; height: 18%;">
          <div>标志上徽章和绳结象征当时意大利的哪个王朝?<br>
            🔍检索PRADA PEDIA - QUALITY</div>
        </button>
      </div>
      <div style="position:absolute;left:71.43%;top:0%;width:14.29%;height:17.5%;" id="B_C">
        <!-- B_C button -->
        <button id="button_C" class="flowing-light-effect" style="position: absolute; left: 50%; top: 89%; transform: translate(-50%, -50%); width: 90%; height: 18%;">
          <div>坐上PRADA列车好奇心爆棚前往你想到达的任意字母格<br>
            🔍检索 PRADAPEDIA - CURIOSITY</div>
        </button>
      </div>
      <div style="position:absolute;left:85.71%;top:0%;width:14.29%;height:17.5%;" id="B_Pass">
      </div>
      <!--x 第1行的格子结束 x-->


      <!-- 这里开始是第2行的格子 -->
      <div style="position:absolute;left:0%;top:17.5%;width:14.29%;height:18.5%;" id="B_K">
      </div>
      <div style="position:absolute;left:14.29%;top:17.5%;width:14.29%;height: 18.5%;" id="B_X">
      </div>
      <div style="position:absolute;left:28.57%;top:17.5%;width:14.29%;height: 18.5%;" id="B_W">
      </div>
      <div style="position:absolute;left:42.86%;top:17.5%;width:14.29%;height: 18.5%;" id="B_Pass2">
      </div>
      <div style="position:absolute;left:57.14%;top:17.5%;width:14.29%;height: 18.5%;" id="B_N">
      </div>
      <div style="position:absolute;left:71.43%;top:17.5%;width:14.29%;height: 18.5%;" id="B_I">
      </div>
      <div style="position:absolute;left:85.71%;top:17.5%;width:14.29%;height: 18.5%;" id="B_G">
      </div>
      <!--x 第2行的格子结束 x-->

      <!-- 这里开始是第3行的格子 -->
      <div style="position:absolute;left:0%;top:36%;width:14.29%;height: 18.5%;" id="B_Pass3">
      </div>
      <div style="position:absolute;left:14.29%;top:36%;width:14.29%;height: 18.5%;" id="B_J">
      </div>
      <div style="position:absolute;left:28.57%;top:36%;width:14.29%;height: 18.5%;" id="B_Y">
      </div>
      <div style="position:absolute;left:42.86%;top:36%;width:14.29%;height: 18.5%;" id="B_E">
      </div>
      <div style="position:absolute;left:57.14%;top:36%;width:14.29%;height: 18.5%;" id="B_Choose3">
      </div>
      <div style="position:absolute;left:71.43%;top:36%;width:14.29%;height: 18.5%;" id="B_F">
      </div>
      <div style="position:absolute;left:85.71%;top:36%;width:14.29%;height: 18.5%;" id="B_S">
      </div>
      <!--x 第3行的格子结束 x-->

      <!-- 这里开始是第4行的格子 -->
      <div style="position:absolute;left:0%;top:54.5%;width:14.29%;height: 18.5%;" id="B_U">
      </div>
      <div style="position:absolute;left:14.29%;top:54.5%;width:14.29%;height: 18.5%;" id="B_L">
      </div>
      <div style="position:absolute;left:28.57%;top:54.5%;width:14.29%;height: 18.5%;" id="B_Choose4">
      </div>
      <div style="position:absolute;left:42.86%;top:54.5%;width:14.29%;height: 18.5%;" id="B_V">
      </div>
      <div style="position:absolute;left:57.14%;top:54.5%;width:14.29%;height: 18.5%;" id="B_P">
      </div>
      <div style="position:absolute;left:71.43%;top:54.5%;width:14.29%;height: 18.5%;" id="B_A">
      </div>
      <!--      <div style="position:absolute;left:85.71%;top:54.5%;width:14.29%;height: 18.5%;;" id="B_R">-->
      <!--      </div>-->
      <div style="position:absolute;left:85.71%;top:54.5%;width:14.29%;height: 18.5%;" id="B_H">
      </div>
      <!--x 第4行的格子结束 x-->

      <!-- 这里开始是第5行的格子 -->
      <div style="position:absolute;left:0%;top:73%;width:14.2%;height: 18.5%;" id="B_D">
      </div>
      <div style="position:absolute;left:14.29%;top:73%;width:14.2%;height: 18.5%;" id="B_K">
      </div>
      <div style="position:absolute;left:28.57%;top:73%;width:14.2%;height: 18.5%;" id="B_M">
      </div>
      <div style="position:absolute;left:42.86%;top:73%;width:14.2%;height: 18.5%;" id="B_R">
      </div>
      <div style="position:absolute;left:57.14%;top:73%;width:14.2%;height: 18.5%;" id="B_T">
      </div>
      <div style="position:absolute;left:71.43%;top:73%;width:14.2%;height: 18.5%;" id="B_Z">
      </div>
      <div style="position: absolute; left: 85.71%; top: 73%; width: 14.2%; height: 18.5%;" id="B_End">
        <button id="imageButton" style="width: 59%; height: 62%;">
          <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E8%A9%9E%E6%A2%9D/end_icon.png?raw=true" alt="Button Image" style="width: 99%; height: 99.5%; position: relative; top: 50%; left: 50%;">
        </button>
      </div>

      <!--x 第5行的格子结束 x-->

    </div>
  </div>
</div>
</div>

<script>
//事件监听，新增了按钮
document.addEventListener('DOMContentLoaded', function () {
  var card = document.getElementById('card');
  var cardImage = card.querySelector('img'); // 获取 card 中的图片元素

  // 显示带有指定图片的卡片的函数
  function showCardWithImage(imageUrl,now_ID) {
    button=document.getElementById(now_ID)
    cardImage.src = imageUrl; // 设置图片源
    var centerX = window.scrollX+window.innerWidth / 2; 
    var centerY = window.scrollY + (window.innerHeight / 2); 
    /* card.style.left = button.left + 'px';
    card.style.top = button.top + 'px'; */
    card.style.left = centerX+button.offsetLeft + 'px';
    card.style.top = card.height/2+button.offsetTop + 'px';
    card.style.width = "80%";
    card.style.display = 'block'; // 显示卡片
    card.style.animation = 'rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards'; // 应用动画


  }


  // 绑定到 B_Start 按钮的事件监听器
  document.getElementById('startButton').addEventListener('click', function() {
    showCardWithImage('https://github.com/vita-cpu/Pradaproject/blob/main/Start.png?raw=true','startButton');
  });


  // 绑定到 B_Q 格子里的按钮的事件监听器
  document.getElementById('button_Q').addEventListener('click', function() {
    showCardWithImage('https://github.com/vita-cpu/Pradaproject/blob/main/%E8%A9%9E%E6%A2%9D/%E8%AF%8D%E6%9D%A1-Q.png?raw=true','startButton');
  });


  // 添加用于 B_End 按钮的事件监听器
  document.getElementById('imageButton').addEventListener('click', function() {
    showCardWithImage('https://github.com/vita-cpu/Pradaproject/blob/main/End.png?raw=true','B_End');
  });
  // 点击卡片时隐藏卡片并移除动画的事件监听器
  document.getElementById('card').addEventListener('click', function() {
    card.style.display = 'none';
  });
});





  //这里是控制边缘线啥的，限制移动的代码
  document.addEventListener('DOMContentLoaded', function() {
    var character = document.getElementById('character');

    // 判断是否可以越过上下边界
    function canCrossBoundary(cellId) {
      //  return ['B_Pass', 'B_G', 'B_Pass3', 'B_K', 'B_F', 'B_U', 'B_R', 'B_D'].includes(cellId);
      return ['B_Pass', 'B_K', 'B_S', 'B_U'].includes(cellId);
    }

    function canCrossBoundary2(cellId) {
      return [ 'B_G', 'B_Pass3', 'B_H', 'B_D'].includes(cellId);
    }



    // 处理角色移动
    function handleCharacterMove(event) {
      var map_array=[["B_Start","B_O","B_Q","B_C","B_Pass"],
        ["B_G","B_I","B_N","B_Pass2","B_W","B_X","B_K"],
        ["B_Pass3","B_Y","B_J","B_E","B_Choose3","B_F","B_S"],
        ["B_H","B_R","B_A","B_P","B_V","B_Choose4","B_L","B_U"],
        ["B_D","B_B","B_M","B_T","B_Z","B_End","B_Ans"]]
      var target = event.target;
      if (!target.id.startsWith('B_')) return; // 忽略非 B_ 开头的元素

      var currentCellId = character.getAttribute('data-current-cell') || 'B_Start';
      var targetCellId = target.id;

      var mouseX = event.clientX; // 水平坐标
      var mouseY = event.clientY; // 垂直坐标



      //  var message = "currentCellId：" + currentCellId + "\n targetCellId：" + targetCellId;
      //  alert(message);

      var findElementPosition=function (twoDArray, target)
      {
        var order=0
        for (let i = 0; i < twoDArray.length; i++) { // 遍历每一行
          for (let j = 0; j < twoDArray[i].length; j++) { // 遍历每一行的每一列
            order=order+1
            if (twoDArray[i][j] === target) {
              return { row: i, col: j,order:order }; // 找到目标，返回位置
            }
          }
        }
        return null; // 如果没有找到目标，返回null
      }
      var position_currentCell=findElementPosition(map_array,currentCellId)
      var position_targetCell=findElementPosition(map_array,targetCellId)
      // var message = "currentCellId：" + currentCellId + "\n targetCellId：" + targetCellId+"\n"+position_currentCell.row+"\n"+position_targetCell.row+"\n"+position_targetCell.order;
      // alert(message);

      var PassCheck = function() {
        if (targetCellId=="B_Pass"){
          alert("恭喜你打开传送门！向前前进一格")
          var B_G = document.getElementById("B_G");

          var x = B_G.getBoundingClientRect().left + window.scrollX + (B_G.getBoundingClientRect().width - character.offsetWidth) / 2;
          var y = B_G.getBoundingClientRect().top + window.scrollY + (B_G.getBoundingClientRect().height - character.offsetHeight) / 2;
          moveCharacterTo2(x, y,targetCellId);

          character.setAttribute('data-current-cell', "B_G");

        }
        if (targetCellId=="B_Pass3"){
          alert("恭喜你打开传送门！向前前进两格")
          var B_Y = document.getElementById("B_Y");

          var x = B_Y.getBoundingClientRect().left + window.scrollX + (B_Y.getBoundingClientRect().width - character.offsetWidth) / 2;
          var y = B_Y.getBoundingClientRect().top + window.scrollY + (B_Y.getBoundingClientRect().height - character.offsetHeight) / 2;
          character.setAttribute('data-current-cell', "B_Y");
          moveCharacterTo2(x, y,targetCellId);
        }
      }
      var finalMove = function() {
        // 计算点击位置
        var rect = target.getBoundingClientRect();
        // var x = rect.left + window.scrollX + (rect.width - character.offsetWidth) / 2;
        // var y = rect.top + window.scrollY + (rect.height - character.offsetHeight) / 2;
        var x = mouseX-character.offsetWidth;
        var y = mouseY-character.offsetHeight;
        var res1= position_currentCell.row -position_targetCell.row; // 计算是否处在同一行
        var res2=position_targetCell.order-position_currentCell.order; //计算是否能穿梭
        // var message = "x: " + x+" y:" + y + "\n x2: " + x2+"y2: "+y2+"\n now_x: "+character.style.left+" now_y: "+character.style.top;
        // alert(message);

        //  res1=0表示没有跨行 res1!=0表示跨行了
        if(res1!=0){ //跨行了
          if (res2==-1){ //跨行且能到上一行
            moveCharacterTo(x, y,targetCellId);
            character.setAttribute('data-current-cell', targetCellId);
          }
            // alert( position_currentCell.row,"-",position_targetCell.row, "-",res1)
          // if ((canCrossBoundary(currentCellId)&canCrossBoundary2(targetCellId))&((currentCellId!="B_Pass")|(targetCellId!="B_Pass3"))){
          else if ((res2==1)){ //跨行且能到下一行
            moveCharacterTo(x, y,targetCellId,function(){
              PassCheck();
            });
            character.setAttribute('data-current-cell', targetCellId);
          }
          else{ //跨行且不能穿梭
            // alert("currentCellId：" + currentCellId + "\n targetCellId：" + targetCellId);
            // alert( position_currentCell.row,"-",position_targetCell.row, "-",res1);
            alert("无法进行该移动");
            bounceCharacter(3, 600); // 碰撞时弹跳三次，每次弹跳600毫秒
          }
        }else{// 没有跨行
          if (res2<0){ //没有跨行，往回走，不会再次触发传送门
            moveCharacterTo(x, y,targetCellId);
            character.setAttribute('data-current-cell', targetCellId);
          }else{
            moveCharacterTo(x, y,targetCellId,function(){
              PassCheck()
            });
            character.setAttribute('data-current-cell', targetCellId);
          }
        }
      }

      finalMove();





       // 确定目标元素
var targetElement = document.getElementById('B_Start');

// 检查是否是目标元素
if (target.id === 'B_Start') {
  // 滑动到目标元素
  targetElement.scrollIntoView({
    behavior: 'smooth', // 平滑滑动
    block: 'center',    // 将元素的中心对齐到视口的中心
    inline: 'center'    // 在可能的情况下，不进行水平滚动
  });
}
    };


    function bounceCharacter(times, duration) {
      let count = 0;
      let interval = setInterval(() => {
        if (count >= times) {
          clearInterval(interval); // 达到弹跳次数后停止
          character.classList.remove('jumping'); // 移除弹跳类
        } else {
          character.classList.add('jumping'); // 添加弹跳类
          setTimeout(() => character.classList.remove('jumping'), duration / 2); // 半途移除弹跳类以完成一次弹跳
        }
        count++;
      }, duration);
    }

    // 为每个格子添加点击事件监听
    document.querySelectorAll('[id^="B_"]').forEach(function(cell) {
      cell.addEventListener('click', handleCharacterMove);
    });

    //解决抽搐问题新增
    var isMoving = false;

    function moveCharacterTo(x, y, targetCellId, callback) {
      //解决抽搐问题新增
        if (isMoving) return; // 如果角色正在移动，则不执行任何操作
        isMoving = true; // 设置移动标志

        //原代码，上面的是新增的
      var startX = parseInt(character.style.left, 10) || 0;
      var startY = parseInt(character.style.top, 10) || 0;
      var endX = x+window.scrollX;
      var endY = y+window.scrollY;

      // Calculate the displacement for each step
      var deltaX = (endX - startX) / 7;
      var deltaY = (endY - startY) / 7;

      // Perform a small jump with each step
      for (let i = 1; i <= 7; i++) {
        setTimeout(function() {
          var nextX = startX + deltaX * i;
          var nextY = startY + deltaY * i;
          character.style.left = nextX + 'px';
          character.style.top = nextY + 'px';
          character.classList.add('jumping'); // Start the small jump
                    // 计算滚动的目标位置
          var scrollX = nextX - (character.offsetWidth/2 ) - (window.innerWidth / 2);
          var scrollY = nextY - (character.offsetHeight/2) - (window.innerHeight / 2);

            // 滑动浏览器窗口以将div2的右下角置于屏幕中央
            window.scrollTo({
                top: scrollY,
                left: scrollX,
                behavior: 'smooth'
            });


     
        }, i * 600); // Adjust the delay for each step
        
        setTimeout(function() {
          character.classList.remove('jumping'); // End the small jump
        }, i * 600 + 300); // Adjust the duration for each jump
      }


      // Callback function after completing the movement
      //这里新增了（index10的变化）
      setTimeout(function() {
        isMoving = false;
        if (callback) {
          callback();
        }
      }, 6000);
    }


    //这是V10修改抽搐问题后的代码
    function moveCharacterTo2(x, y, targetCellId, callback) {
      if (isMoving) return; // 如果角色正在移动，则不执行任何操作
      isMoving = true; // 设置移动标志

      character.style.display = 'none'; // 隐藏角色
      character.style.left = x + 'px';
      character.style.top = y + 'px';

      setTimeout(function() {
        character.style.display = 'block'; // 显示角色
        isMoving = false; // 重置移动标志
        window.scrollTo({
              top: scrollY,
              left: scrollX,
              behavior: 'smooth'
          });
        if (callback) {
          callback();
        }
      }, 1); // 短暂延迟以实现瞬移效果
    }

    function positionCharacterInBStart() {
    // 获取元素
    var character = document.getElementById('character');
    var bStart = document.getElementById('B_Start');

    // 确保两个元素都存在
    if (character && bStart) {
      
        var bStartRect = bStart.getBoundingClientRect();

        // 计算B_Start的中心位置
        var centerX = bStartRect.left + (bStartRect.width / 2);
        var centerY = bStartRect.top + (bStartRect.height / 2);

        // 设置character的样式
        character.style.position = 'absolute';
        character.style.left = centerX - (character.offsetWidth / 2) + 'px';
        character.style.top = centerY - (character.offsetHeight / 2) + 'px';

        // var scrollX = bStartRect.left + (bStartRect.offsetWidth / 2) - (window.innerWidth / 2);
        // var scrollY =  bStartRect.left + (bStartRect.offsetHeight / 2) - (window.innerHeight / 2);


        // window.scrollTo({
        //       top: scrollY,
        //       left: scrollX,
        //       behavior: 'smooth'
        //   });
    }
}


window.onload = function() {

      // 2. 获取浏览器窗口大小
    var browserWidth = window.innerWidth;
    var browserHeight = window.innerHeight;

    // 3. 获取 'whole_map' 元素的大小和位置
    var map = document.getElementById('whole_map');

    var character = document.getElementById('character');
    if (map) {
        var rect = map.getBoundingClientRect();

        // 4. 计算缩放比例
        var scaleX = browserWidth / rect.width;
        var scaleY = browserHeight / rect.height;
        var scale = Math.max(scaleX, scaleY);

        // 5. 设置 'whole_map' 元素的缩放和位置
        map.style.transformOrigin = 'top left';
        map.style.transform = `scale(${scale})`;
        map.style.position = 'absolute';
        map.style.left = -rect.left + 'px';
        map.style.top = -rect.top + 'px';
    }
        positionCharacterInBStart();

        setTimeout(() => {

        var bStartRect = document.getElementById("B_Start");
        bStartRect.scrollIntoView()
        /* window.resizeTo(map.style.width,map.style.height) */
        alert(window.innerWidth)
        },1000);

  };
  });


// 显示带有指定图片的卡片的函数
function showCardWithImage(imageUrl,now_ID) {
  button=document.getElementById(now_ID)
  cardImage.src = imageUrl; // 设置图片源
  var centerX = window.scrollX+window.innerWidth / 2;
  var centerY = window.scrollY + (window.innerHeight / 2);
  /* card.style.left = button.left + 'px';
    card.style.top = button.top + 'px'; */
  card.style.left = centerX+button.offsetLeft + 'px';
  card.style.top = card.height/2+button.offsetTop + 'px';
  card.style.width = "80%";
  card.style.display = 'block'; // 显示卡片
  card.style.animation = 'rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards'; // 应用动画


}
// //V11新增滑动特效
// document.addEventListener('click', function(event) {
//   var character = document.getElementById('character'); // 获取ID为'character'的元素
//   var wholeMap = document.getElementById('whole_map'); // 获取ID为'whole_map'的元素
//
//   // 计算'character'元素的新位置
//   var newX = event.clientX - character.offsetWidth / 2; // 新的X坐标
//   var newY = event.clientY - character.offsetHeight / 2; // 新的Y坐标
//
//   // 将'character'元素移动到新位置
//   character.style.left = newX + 'px'; // 设置新的左边距
//   character.style.top = newY + 'px'; // 设置新的顶边距
//
//   // 移动背景以产生视差效果
//   var backgroundShiftX = -newX; // 背景X轴的移动量
//   var backgroundShiftY = -newY; // 背景Y轴的移动量
//
//   wholeMap.style.left = backgroundShiftX + 'px'; // 设置背景的新左边距
//   wholeMap.style.top = backgroundShiftY + 'px'; // 设置背景的新顶边距
// });

// //V12尝试新的平移（绑定格子）
// document.addEventListener('click', function(event) {
//   var character = document.getElementById('character'); // Get the 'character' element
//   var gridContainer = document.getElementById('grid-container'); // Get the 'grid-container' element
//
//   // Calculate the new position for the character
//   var newX = event.clientX - character.offsetWidth / 2;
//   var newY = event.clientY - character.offsetHeight / 2;
//
//   // Move the character to the new position
//   character.style.transform = `translate(${newX}px, ${newY}px)`;
//
//   // Move the grid container in the opposite direction
//   gridContainer.style.transform = `translate(${-newX}px, ${-newY}px)`;
// });
// //
// 但要新增<div id="grid-container">
//         <!-- All your grid divs go here -->
//         </div>


</script>

</body>
</html>
