<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Character with Enhanced Jump Effect</title>
  <style>
    body, html {
      margin: 0;
      height: 100%;
      overflow: auto;
    }

/*å¼€å§‹æ ¼å­æŒ‰é’®çš„ç‰¹æ•ˆ*/
     @property --border-angle-1 {
      syntax: "<angle>";
      inherits: true;
      initial-value: 0deg;
    }
    @property --border-angle-2 {
      syntax: "<angle>";
      inherits: true;
      initial-value: 90deg;
    }
    @property --border-angle-3 {
      syntax: "<angle>";
      inherits: true;
      initial-value: 180deg;
    }
    :root {
      --white: #fff;
      --background: black;
      --foreground: white;
      --border-size: 1px;
      --border-radius: .75em;
    }
    @keyframes rotateBackground {
      to { --border-angle-1: 360deg; }
    }
    @keyframes rotateBackground2 {
      to { --border-angle-2: -270deg; }
    }
    @keyframes rotateBackground3 {
      to { --border-angle-3: 540deg; }
    }
    #startButton {
      position: absolute;
      left: 50%;
      top: 80%;
      transform: translate(-50%, -50%);
      width: 80%;
      height: 26%;
      color: inherit;
      font-family: inherit;
      border: 0;
      padding: var(--border-size);
      border-radius: var(--border-radius);
      background-color: transparent;
      background-image: conic-gradient(from var(--border-angle-1) at 10% 15%, transparent, var(--white) 10%, transparent 30%, transparent),
      conic-gradient(from var(--border-angle-2) at 70% 60%, transparent, var(--white) 10%, transparent 60%, transparent),
      conic-gradient(from var(--border-angle-3) at 50% 20%, transparent, var(--white) 10%, transparent 50%, transparent);
      animation: rotateBackground 3s linear infinite,
      rotateBackground2 8s linear infinite,
      rotateBackground3 13s linear infinite;
    }
    #startButton div {
      background: var(--background);
      padding: 2.5em 1.8em;
      border-radius: calc(var(--border-radius) - var(--border-size));
      color: var(--foreground);
    }

    /* ä¿ç•™åŸæœ‰å…³é”®å¸§åŠ¨ç”»å®šä¹‰ */

    #B_O button, #B_Q button, #B_C button {
      position: absolute;
      left: 50%;
      top: 87%;
      transform: translate(-50%, -50%);
      width: 90%; /* ç¡®ä¿ä¸ç‰¹æ•ˆæ¡†å®½åº¦ä¸€è‡´ */
      height: 26%; /* ç¡®ä¿ä¸ç‰¹æ•ˆæ¡†é«˜åº¦ä¸€è‡´ */
      color: inherit;
      font-family: inherit;
      border: 0;
      padding: var(--border-size);
      border-radius: var(--border-radius);
      background-color: transparent;
      background-image: conic-gradient(from var(--border-angle-1) at 10% 15%, transparent, var(--white) 10%, transparent 30%, transparent),
      conic-gradient(from var(--border-angle-2) at 70% 60%, transparent, var(--white) 10%, transparent 60%, transparent),
      conic-gradient(from var(--border-angle-3) at 50% 20%, transparent, var(--white) 10%, transparent 50%, transparent);
      animation: rotateBackground 3s linear infinite,
      rotateBackground2 8s linear infinite,
      rotateBackground3 13s linear infinite;
    }

    #B_O div, #B_C div {
      background: #79C38E; /* è®¾ç½®ä¸ºåå…­è¿›åˆ¶é¢œè‰² #79C38E */
      padding: 1em 1em;
      border-radius: calc(var(--border-radius) - var(--border-size));
      color: var(--foreground);
      font-size: 0.6em;
    }

    #B_Q div {
      background: var(--background); /* B_Q ä¿æŒåŸæœ‰çš„èƒŒæ™¯è‰² */
      padding: 1em 1em;
      border-radius: calc(var(--border-radius) - var(--border-size));
      color: var(--foreground);
      font-size: 0.6em;
    }

    /*!*V13è§£å†³å±å¹•æ°´å¹³æ»‘åŠ¨çš„æ–°ç‰¹æ•ˆ*!*/
    /*#grid-container {*/
    /*  position: absolute;*/
    /*  transition: transform 0.3s ease; // Smooth transition for movement*/
    /*}*/


/*è¿™é‡Œå¼€å§‹æ˜¯å¡ç‰‡*/ 
/*ä¿®æ”¹4: æ›´æ”¹cardçš„ä½ç½®ã€æ¯”ä¾‹ï¼Œæœ€å¥½èƒ½æŠŠç™¾åˆ†æ¯”å’Œæ•°å­—ç›¸å…³çš„å†…å®¹ï¼Œç”¨vw vhè®¾ç½®ï¼Œæ¯”å¦‚top, left, width, heightè¿™äº›ã€‚*/    
#card {
      display: none; /* Default to not displayed */
      position: fixed;
      top: 30vh;
      left: 45vw;
      transform: translate(-50%, -50%)scale(0.5);
      z-index: 1000; /* Make sure this is higher than other elements */
      background-color: white;
      border: 1px solid black;
      padding: 0px;
      width: 30vw; /* Adjust as necessary */
      height: auto; /* Adjust as necessary */
      max-width: 80vw; /* Prevent the image from being too large */
      max-height: auto; /* Prevent the image from being too large */
      overflow: hidden; /* Hide the overflow */
      animation: rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; /* ä½¿ç”¨ cubic-bezier å‡½æ•° */
      justify-content: center;
      align-items: center;
      /* width: 30vw;height: 90vh; justify-content: center;align-items: center; */
    }
    #card img {
      width: 100%; /* Adjust the image to the container width */
      height: 100%; /* Adjust the image height automatically */
    }
    #game-board {
      position: relative;
      width: 5%;
      height: 5%;
      /* background-image: url('https://github.com/vita-cpu/Pradaproject/blob/main/%E6%A3%8B%E7%9B%98%E6%9B%B4%E6%96%B0_00.png?raw=true');
      background-position: center;
      background-repeat: no-repeat;
      background-size: contain; */
    }


    @keyframes rotateCard {
      0% {
        transform: translate(-50%, -50%) scale(0.3) rotate(0deg);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -50%) scale(0.5) rotate(360deg);
        opacity: 1;
      }
    }

    .character {
      position: absolute;
      top: 0;
      left: 0;
      width: 2%;
      cursor: pointer;
      transition: left 0.5s, top 0.5s;
    }

    @keyframes jump {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-30%); } /* Increased jump height */
    }

    .jumping {
      animation: jump 0.6s ease-out;
    }

    .image-container {
      /* padding-left: 10%; */
      width: 100%; /* è®¾ç½®å®½åº¦ä¸º100% */
      height: auto; /* é«˜åº¦è‡ªåŠ¨è°ƒæ•´ */
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: auto; /* å…è®¸æ»šåŠ¨ */
    }

    .image-container img {
      max-width: 100%; /* å›¾ç‰‡æœ€å¤§å®½åº¦ä¸º100% */
      height: auto; /* é«˜åº¦è‡ªåŠ¨è°ƒæ•´ */
    }






  </style>
</head>
<body>

<div class="image-container" id="image_container">
  <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E9%99%8D%E8%90%BD%E4%BC%9E-%E6%A9%99.png?raw=true" alt="Character Icon"
       class="character" id="character" style="width: 20vw; height:auto; z-index:1;">

  <div style="position: relative;width:700vw;height: 250vh;" id="whole_map">
    <div id="card">
      <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E5%8D%A1%E7%89%87.png?raw=true'" alt="Displayed Image" /> <!-- ç¤ºä¾‹å›¾ç‰‡ï¼Œæ‚¨å¯ä»¥æ›¿æ¢ä¸ºæ‚¨å¸Œæœ›æ˜¾ç¤ºçš„å›¾ç‰‡ -->
    </div>
    <!-- ä¿®æ”¹1: æ›¿æ¢æœ€æ–°çš„åœ°å›¾ -->
    <img src="https://github.com/vita-cpu/Pradaproject/blob/main/%E8%AA%8C%E5%B1%8Bvol39_prada%E6%A3%8B%E7%9B%98.jpg?raw=true" alt="Your Image"> 
    <!-- # ä¿®æ”¹2: æ›´æ”¹"left:2%;top:3.3%;width:96%;height: 82.7%;"è¿™ä¸€å †æ•°å€¼ï¼Œè®©å®ƒèƒ½å®Œæ•´åˆ‡å‰²æ•´ä½“æ ¼å­ -->
    <div style="position:absolute;left:0%;top:0%;width:100%;height: 100%;" id="block">
      <!-- è¿™é‡Œå¼€å§‹æ˜¯ç¬¬1è¡Œçš„æ ¼å­ -->
      <div style="position:absolute;left:0%;top:0%;width:28.57%;height:17.5%;" id="logo">
      </div>
      <!-- Bè¡¨ç¤ºBlockæ ¼å­ï¼ŒB_Startè¡¨ç¤º Start è¿™ä¸ªæ ¼å­ï¼›åŒç† B_Oè¡¨ç¤ºå­—æ¯ä¸ºOçš„æ ¼å­ -->
      <div style="position:absolute;left:28.57%;top:0%;width:14.29%;height:17.5%;" id="B_Start">
        <!-- # ä¿®æ”¹3: è°ƒæ•´æ¯ä¸ªbuttonï¼Œä½ å¯ä»¥ä»¿ç…§STARTè¿™æ ·å»å†™ã€‚ä¸€èˆ¬æ¥è¯´ç›´æ¥æŠŠæ–‡æœ¬æ”¾åœ¨buttoné‡Œé¢å°±è¡Œï¼Œä¸ç”¨å¦å¼€div  -->
        <button id="startButton" class="flowing-light-effect" style="position: absolute; left: 50%; top: 84%; width: 80%; height: 24%;transform: translate(-50%, -50%);">
            <div>
                START
            </div>
        </button>

      </div>


      <div style="position:absolute;left:42.86%;top:0%;width:14.29%;height:17.5%;" id="B_O">
        <button id="button_O" class="flowing-light-effect" style="position: absolute; left: 50%; top: 89%; transform: translate(-50%, -50%); width: 90%; height: 12%;">
          <div>å¥¥æ–¯æ›¼å¸å›½åœ¨æ„å¤§åˆ©è´¥é€€,PRADAæ­£å¼åœ¨ç±³å…°åˆ›ç«‹ã€‚<br>
            ğŸ”æ£€ç´¢PRADA PEDIA -ORIGINS</div>
      </div>
      <div style="position:absolute;left:57.14%;top:0%;width:14.29%;height:17.5%;" id="B_Q">
        <!-- B_Q button -->
        <button id="button_Q" class="flowing-light-effect" style="position: absolute; left: 50%; top: 89%; transform: translate(-50%, -50%); width: 90%; height: 12%;">
          <div>æ ‡å¿—ä¸Šå¾½ç« å’Œç»³ç»“è±¡å¾å½“æ—¶æ„å¤§åˆ©çš„å“ªä¸ªç‹æœ?<br>
            ğŸ”æ£€ç´¢PRADA PEDIA - QUALITY</div>
        </button>
      </div>
      <div style="position:absolute;left:71.43%;top:0%;width:14.29%;height:17.5%;" id="B_C">
        <!-- B_C button -->
        <button id="button_C" class="flowing-light-effect" style="position: absolute; left: 50%; top: 89%; transform: translate(-50%, -50%); width: 90%; height: 12%;">
          <div>åä¸ŠPRADAåˆ—è½¦å¥½å¥‡å¿ƒçˆ†æ£šå‰å¾€ä½ æƒ³åˆ°è¾¾çš„ä»»æ„å­—æ¯æ ¼<br>
            ğŸ”æ£€ç´¢ PRADAPEDIA - CURIOSITY</div>
        </button>
      </div>
      <div style="position:absolute;left:85.71%;top:0%;width:14.29%;height:17.5%;" id="B_Pass">
      </div>
      <!--x ç¬¬1è¡Œçš„æ ¼å­ç»“æŸ x-->


      <!-- è¿™é‡Œå¼€å§‹æ˜¯ç¬¬2è¡Œçš„æ ¼å­ -->
      <div style="position:absolute;left:0%;top:17.5%;width:14.29%;height:18.5%;" id="B_K">
      </div>
      <div style="position:absolute;left:14.29%;top:17.5%;width:14.29%;height: 18.5%;" id="B_X">
      </div>
      <div style="position:absolute;left:28.57%;top:17.5%;width:14.29%;height: 18.5%;" id="B_W">
      </div>
      <div style="position:absolute;left:42.86%;top:17.5%;width:14.29%;height: 18.5%;" id="B_Pass2">
      </div>
      <div style="position:absolute;left:57.14%;top:17.5%;width:14.29%;height: 18.5%;" id="B_N">
      </div>
      <div style="position:absolute;left:71.43%;top:17.5%;width:14.29%;height: 18.5%;" id="B_I">
      </div>
      <div style="position:absolute;left:85.71%;top:17.5%;width:14.29%;height: 18.5%;" id="B_G">
      </div>
      <!--x ç¬¬2è¡Œçš„æ ¼å­ç»“æŸ x-->

      <!-- è¿™é‡Œå¼€å§‹æ˜¯ç¬¬3è¡Œçš„æ ¼å­ -->
      <div style="position:absolute;left:0%;top:36%;width:14.29%;height: 18.5%;" id="B_Pass3">
      </div>
      <div style="position:absolute;left:14.29%;top:36%;width:14.29%;height: 18.5%;" id="B_J">
      </div>
      <div style="position:absolute;left:28.57%;top:36%;width:14.29%;height: 18.5%;" id="B_Y">
      </div>
      <div style="position:absolute;left:42.86%;top:36%;width:14.29%;height: 18.5%;" id="B_E">
      </div>
      <div style="position:absolute;left:57.14%;top:36%;width:14.29%;height: 18.5%;" id="B_Choose3">
      </div>
      <div style="position:absolute;left:71.43%;top:36%;width:14.29%;height: 18.5%;" id="B_F">
      </div>
      <div style="position:absolute;left:85.71%;top:36%;width:14.29%;height: 18.5%;" id="B_S">
      </div>
      <!--x ç¬¬3è¡Œçš„æ ¼å­ç»“æŸ x-->

      <!-- è¿™é‡Œå¼€å§‹æ˜¯ç¬¬4è¡Œçš„æ ¼å­ -->
      <div style="position:absolute;left:0%;top:54.5%;width:14.29%;height: 18.5%;" id="B_U">
      </div>
      <div style="position:absolute;left:14.29%;top:54.5%;width:14.29%;height: 18.5%;" id="B_L">
      </div>
      <div style="position:absolute;left:28.57%;top:54.5%;width:14.29%;height: 18.5%;" id="B_Choose4">
      </div>
      <div style="position:absolute;left:42.86%;top:54.5%;width:14.29%;height: 18.5%;" id="B_V">
      </div>
      <div style="position:absolute;left:57.14%;top:54.5%;width:14.29%;height: 18.5%;" id="B_P">
      </div>
      <div style="position:absolute;left:71.43%;top:54.5%;width:14.29%;height: 18.5%;" id="B_A">
      </div>
      <!--      <div style="position:absolute;left:85.71%;top:54.5%;width:14.29%;height: 18.5%;;" id="B_R">-->
      <!--      </div>-->
      <div style="position:absolute;left:85.71%;top:54.5%;width:14.29%;height: 18.5%;" id="B_H">
      </div>
      <!--x ç¬¬4è¡Œçš„æ ¼å­ç»“æŸ x-->

      <!-- è¿™é‡Œå¼€å§‹æ˜¯ç¬¬5è¡Œçš„æ ¼å­ -->
      <div style="position:absolute;left:0%;top:73%;width:14.2%;height: 18.5%;" id="B_D">
      </div>
      <div style="position:absolute;left:14.29%;top:73%;width:14.2%;height: 18.5%;" id="B_K">
      </div>
      <div style="position:absolute;left:28.57%;top:73%;width:14.2%;height: 18.5%;" id="B_M">
      </div>
      <div style="position:absolute;left:42.86%;top:73%;width:14.2%;height: 18.5%;" id="B_R">
      </div>
      <div style="position:absolute;left:57.14%;top:73%;width:14.2%;height: 18.5%;" id="B_T">
      </div>
      <div style="position:absolute;left:71.43%;top:73%;width:14.2%;height: 18.5%;" id="B_Z">
      </div>
      <div style="position:absolute;left:85.71%;top:73%;width:14.2%;height: 18.5%;" id="B_End">
      </div>
      <!--x ç¬¬5è¡Œçš„æ ¼å­ç»“æŸ x-->

    </div>
  </div>
</div>
</div>

<script>
//äº‹ä»¶ç›‘å¬ï¼Œæ–°å¢äº†æŒ‰é’®
document.addEventListener('DOMContentLoaded', function () {
  var card = document.getElementById('card');
  var cardImage = card.querySelector('img'); // è·å– card ä¸­çš„å›¾ç‰‡å…ƒç´ 

  // æ˜¾ç¤ºå¸¦æœ‰æŒ‡å®šå›¾ç‰‡çš„å¡ç‰‡çš„å‡½æ•°
  function showCardWithImage(imageUrl) {
    cardImage.src = imageUrl; // è®¾ç½®å›¾ç‰‡æº
    card.style.display = 'block'; // æ˜¾ç¤ºå¡ç‰‡
    card.style.animation = 'rotateCard 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards'; // åº”ç”¨åŠ¨ç”»
  }

  // ç»‘å®šåˆ° B_Start æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨
  document.getElementById('startButton').addEventListener('click', function() {
    showCardWithImage('https://github.com/vita-cpu/Pradaproject/blob/main/Start.png?raw=true');
  });

  // ç»‘å®šåˆ° B_Q æ ¼å­é‡Œçš„æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨
  document.getElementById('button_Q').addEventListener('click', function() {
    showCardWithImage('https://github.com/vita-cpu/Pradaproject/blob/main/%E8%A9%9E%E6%A2%9D/%E8%AF%8D%E6%9D%A1-Q.png?raw=true');
  });

  // ç‚¹å‡»å¡ç‰‡æ—¶éšè—å¡ç‰‡å¹¶ç§»é™¤åŠ¨ç”»çš„äº‹ä»¶ç›‘å¬å™¨
  document.getElementById('card').addEventListener('click', function() {
    card.style.display = 'none';
  });
});





  //è¿™é‡Œæ˜¯æ§åˆ¶è¾¹ç¼˜çº¿å•¥çš„ï¼Œé™åˆ¶ç§»åŠ¨çš„ä»£ç 
  document.addEventListener('DOMContentLoaded', function() {
    var character = document.getElementById('character');

    // åˆ¤æ–­æ˜¯å¦å¯ä»¥è¶Šè¿‡ä¸Šä¸‹è¾¹ç•Œ
    function canCrossBoundary(cellId) {
      //  return ['B_Pass', 'B_G', 'B_Pass3', 'B_K', 'B_F', 'B_U', 'B_R', 'B_D'].includes(cellId);
      return ['B_Pass', 'B_K', 'B_S', 'B_U'].includes(cellId);
    }

    function canCrossBoundary2(cellId) {
      return [ 'B_G', 'B_Pass3', 'B_H', 'B_D'].includes(cellId);
    }



    // å¤„ç†è§’è‰²ç§»åŠ¨
    function handleCharacterMove(event) {
      var map_array=[["B_Start","B_O","B_Q","B_C","B_Pass"],
        ["B_G","B_I","B_N","B_Pass2","B_W","B_X","B_K"],
        ["B_Pass3","B_Y","B_J","B_E","B_Choose3","B_F","B_S"],
        ["B_H","B_R","B_A","B_P","B_V","B_Choose4","B_L","B_U"],
        ["B_D","B_B","B_M","B_T","B_Z","B_End","B_Ans"]]
      var target = event.target;
      if (!target.id.startsWith('B_')) return; // å¿½ç•¥é B_ å¼€å¤´çš„å…ƒç´ 

      var currentCellId = character.getAttribute('data-current-cell') || 'B_Start';
      var targetCellId = target.id;

      var mouseX = event.clientX; // æ°´å¹³åæ ‡
      var mouseY = event.clientY; // å‚ç›´åæ ‡



      //  var message = "currentCellIdï¼š" + currentCellId + "\n targetCellIdï¼š" + targetCellId;
      //  alert(message);

      var findElementPosition=function (twoDArray, target)
      {
        var order=0
        for (let i = 0; i < twoDArray.length; i++) { // éå†æ¯ä¸€è¡Œ
          for (let j = 0; j < twoDArray[i].length; j++) { // éå†æ¯ä¸€è¡Œçš„æ¯ä¸€åˆ—
            order=order+1
            if (twoDArray[i][j] === target) {
              return { row: i, col: j,order:order }; // æ‰¾åˆ°ç›®æ ‡ï¼Œè¿”å›ä½ç½®
            }
          }
        }
        return null; // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡ï¼Œè¿”å›null
      }
      var position_currentCell=findElementPosition(map_array,currentCellId)
      var position_targetCell=findElementPosition(map_array,targetCellId)
      // var message = "currentCellIdï¼š" + currentCellId + "\n targetCellIdï¼š" + targetCellId+"\n"+position_currentCell.row+"\n"+position_targetCell.row+"\n"+position_targetCell.order;
      // alert(message);

      var PassCheck = function() {
        if (targetCellId=="B_Pass"){
          alert("æ­å–œä½ æ‰“å¼€ä¼ é€é—¨ï¼å‘å‰å‰è¿›ä¸€æ ¼")
          var B_G = document.getElementById("B_G");

          var x = B_G.getBoundingClientRect().left + window.scrollX + (B_G.getBoundingClientRect().width - character.offsetWidth) / 2;
          var y = B_G.getBoundingClientRect().top + window.scrollY + (B_G.getBoundingClientRect().height - character.offsetHeight) / 2;
          moveCharacterTo2(x, y,targetCellId);

          character.setAttribute('data-current-cell', "B_G");

        }
        if (targetCellId=="B_Pass3"){
          alert("æ­å–œä½ æ‰“å¼€ä¼ é€é—¨ï¼å‘å‰å‰è¿›ä¸¤æ ¼")
          var B_Y = document.getElementById("B_Y");

          var x = B_Y.getBoundingClientRect().left + window.scrollX + (B_Y.getBoundingClientRect().width - character.offsetWidth) / 2;
          var y = B_Y.getBoundingClientRect().top + window.scrollY + (B_Y.getBoundingClientRect().height - character.offsetHeight) / 2;
          character.setAttribute('data-current-cell', "B_Y");
          moveCharacterTo2(x, y,targetCellId);
        }
      }
      var finalMove = function() {
        // è®¡ç®—ç‚¹å‡»ä½ç½®
        var rect = target.getBoundingClientRect();
        // var x = rect.left + window.scrollX + (rect.width - character.offsetWidth) / 2;
        // var y = rect.top + window.scrollY + (rect.height - character.offsetHeight) / 2;
        var x = mouseX-character.offsetWidth;
        var y = mouseY-character.offsetHeight;
        var res1= position_currentCell.row -position_targetCell.row; // è®¡ç®—æ˜¯å¦å¤„åœ¨åŒä¸€è¡Œ
        var res2=position_targetCell.order-position_currentCell.order; //è®¡ç®—æ˜¯å¦èƒ½ç©¿æ¢­
        // var message = "x: " + x+" y:" + y + "\n x2: " + x2+"y2: "+y2+"\n now_x: "+character.style.left+" now_y: "+character.style.top;
        // alert(message);

        //  res1=0è¡¨ç¤ºæ²¡æœ‰è·¨è¡Œ res1!=0è¡¨ç¤ºè·¨è¡Œäº†
        if(res1!=0){ //è·¨è¡Œäº†
          if (res2==-1){ //è·¨è¡Œä¸”èƒ½åˆ°ä¸Šä¸€è¡Œ
            moveCharacterTo(x, y,targetCellId);
            character.setAttribute('data-current-cell', targetCellId);
          }
            // alert( position_currentCell.row,"-",position_targetCell.row, "-",res1)
          // if ((canCrossBoundary(currentCellId)&canCrossBoundary2(targetCellId))&((currentCellId!="B_Pass")|(targetCellId!="B_Pass3"))){
          else if ((res2==1)){ //è·¨è¡Œä¸”èƒ½åˆ°ä¸‹ä¸€è¡Œ
            moveCharacterTo(x, y,targetCellId,function(){
              PassCheck();
            });
            character.setAttribute('data-current-cell', targetCellId);
          }
          else{ //è·¨è¡Œä¸”ä¸èƒ½ç©¿æ¢­
            // alert("currentCellIdï¼š" + currentCellId + "\n targetCellIdï¼š" + targetCellId);
            // alert( position_currentCell.row,"-",position_targetCell.row, "-",res1);
            alert("æ— æ³•è¿›è¡Œè¯¥ç§»åŠ¨");
            bounceCharacter(3, 600); // ç¢°æ’æ—¶å¼¹è·³ä¸‰æ¬¡ï¼Œæ¯æ¬¡å¼¹è·³600æ¯«ç§’
          }
        }else{// æ²¡æœ‰è·¨è¡Œ
          if (res2<0){ //æ²¡æœ‰è·¨è¡Œï¼Œå¾€å›èµ°ï¼Œä¸ä¼šå†æ¬¡è§¦å‘ä¼ é€é—¨
            moveCharacterTo(x, y,targetCellId);
            character.setAttribute('data-current-cell', targetCellId);
          }else{
            moveCharacterTo(x, y,targetCellId,function(){
              PassCheck()
            });
            character.setAttribute('data-current-cell', targetCellId);
          }
        }
      }

      finalMove();





       // ç¡®å®šç›®æ ‡å…ƒç´ 
var targetElement = document.getElementById('B_Start');

// æ£€æŸ¥æ˜¯å¦æ˜¯ç›®æ ‡å…ƒç´ 
if (target.id === 'B_Start') {
  // æ»‘åŠ¨åˆ°ç›®æ ‡å…ƒç´ 
  targetElement.scrollIntoView({
    behavior: 'smooth', // å¹³æ»‘æ»‘åŠ¨
    block: 'center',    // å°†å…ƒç´ çš„ä¸­å¿ƒå¯¹é½åˆ°è§†å£çš„ä¸­å¿ƒ
    inline: 'center'    // åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä¸è¿›è¡Œæ°´å¹³æ»šåŠ¨
  });
}
    };


    function bounceCharacter(times, duration) {
      let count = 0;
      let interval = setInterval(() => {
        if (count >= times) {
          clearInterval(interval); // è¾¾åˆ°å¼¹è·³æ¬¡æ•°ååœæ­¢
          character.classList.remove('jumping'); // ç§»é™¤å¼¹è·³ç±»
        } else {
          character.classList.add('jumping'); // æ·»åŠ å¼¹è·³ç±»
          setTimeout(() => character.classList.remove('jumping'), duration / 2); // åŠé€”ç§»é™¤å¼¹è·³ç±»ä»¥å®Œæˆä¸€æ¬¡å¼¹è·³
        }
        count++;
      }, duration);
    }

    // ä¸ºæ¯ä¸ªæ ¼å­æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
    document.querySelectorAll('[id^="B_"]').forEach(function(cell) {
      cell.addEventListener('click', handleCharacterMove);
    });

    //è§£å†³æŠ½æé—®é¢˜æ–°å¢
    var isMoving = false;

    function moveCharacterTo(x, y, targetCellId, callback) {
      //è§£å†³æŠ½æé—®é¢˜æ–°å¢
        if (isMoving) return; // å¦‚æœè§’è‰²æ­£åœ¨ç§»åŠ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
        isMoving = true; // è®¾ç½®ç§»åŠ¨æ ‡å¿—

        //åŸä»£ç ï¼Œä¸Šé¢çš„æ˜¯æ–°å¢çš„
      var startX = parseInt(character.style.left, 10) || 0;
      var startY = parseInt(character.style.top, 10) || 0;
      var endX = x+window.scrollX;
      var endY = y+window.scrollY;

      // Calculate the displacement for each step
      var deltaX = (endX - startX) / 7;
      var deltaY = (endY - startY) / 7;

      // Perform a small jump with each step
      for (let i = 1; i <= 7; i++) {
        setTimeout(function() {
          var nextX = startX + deltaX * i;
          var nextY = startY + deltaY * i;
          character.style.left = nextX + 'px';
          character.style.top = nextY + 'px';
          character.classList.add('jumping'); // Start the small jump
                    // è®¡ç®—æ»šåŠ¨çš„ç›®æ ‡ä½ç½®
          var scrollX = nextX - (character.offsetWidth/2 ) - (window.innerWidth / 2);
          var scrollY = nextY - (character.offsetHeight/2) - (window.innerHeight / 2);

            // æ»‘åŠ¨æµè§ˆå™¨çª—å£ä»¥å°†div2çš„å³ä¸‹è§’ç½®äºå±å¹•ä¸­å¤®
            window.scrollTo({
                top: scrollY,
                left: scrollX,
                behavior: 'smooth'
            });


     
        }, i * 600); // Adjust the delay for each step
        
        setTimeout(function() {
          character.classList.remove('jumping'); // End the small jump
        }, i * 600 + 300); // Adjust the duration for each jump
      }


      // Callback function after completing the movement
      //è¿™é‡Œæ–°å¢äº†ï¼ˆindex10çš„å˜åŒ–ï¼‰
      setTimeout(function() {
        isMoving = false;
        if (callback) {
          callback();
        }
      }, 6000);
    }


    //è¿™æ˜¯V10ä¿®æ”¹æŠ½æé—®é¢˜åçš„ä»£ç 
    function moveCharacterTo2(x, y, targetCellId, callback) {
      if (isMoving) return; // å¦‚æœè§’è‰²æ­£åœ¨ç§»åŠ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
      isMoving = true; // è®¾ç½®ç§»åŠ¨æ ‡å¿—

      character.style.display = 'none'; // éšè—è§’è‰²
      character.style.left = x + 'px';
      character.style.top = y + 'px';

      setTimeout(function() {
        character.style.display = 'block'; // æ˜¾ç¤ºè§’è‰²
        isMoving = false; // é‡ç½®ç§»åŠ¨æ ‡å¿—
        window.scrollTo({
              top: scrollY,
              left: scrollX,
              behavior: 'smooth'
          });
        if (callback) {
          callback();
        }
      }, 1); // çŸ­æš‚å»¶è¿Ÿä»¥å®ç°ç¬ç§»æ•ˆæœ
    }

    function positionCharacterInBStart() {
    // è·å–å…ƒç´ 
    var character = document.getElementById('character');
    var bStart = document.getElementById('B_Start');

    // ç¡®ä¿ä¸¤ä¸ªå…ƒç´ éƒ½å­˜åœ¨
    if (character && bStart) {
      
        var bStartRect = bStart.getBoundingClientRect();

        // è®¡ç®—B_Startçš„ä¸­å¿ƒä½ç½®
        var centerX = bStartRect.left + (bStartRect.width / 2);
        var centerY = bStartRect.top + (bStartRect.height / 2);

        // è®¾ç½®characterçš„æ ·å¼
        character.style.position = 'absolute';
        character.style.left = centerX - (character.offsetWidth / 2) + 'px';
        character.style.top = centerY - (character.offsetHeight / 2) + 'px';

        // var scrollX = bStartRect.left + (bStartRect.offsetWidth / 2) - (window.innerWidth / 2);
        // var scrollY =  bStartRect.left + (bStartRect.offsetHeight / 2) - (window.innerHeight / 2);


        // window.scrollTo({
        //       top: scrollY,
        //       left: scrollX,
        //       behavior: 'smooth'
        //   });
    }
}


window.onload = function() {

      // 2. è·å–æµè§ˆå™¨çª—å£å¤§å°
    var browserWidth = window.innerWidth;
    var browserHeight = window.innerHeight;

    // 3. è·å– 'whole_map' å…ƒç´ çš„å¤§å°å’Œä½ç½®
    var map = document.getElementById('whole_map');

    var character = document.getElementById('character');
    if (map) {
        var rect = map.getBoundingClientRect();

        // 4. è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
        var scaleX = browserWidth / rect.width;
        var scaleY = browserHeight / rect.height;
        var scale = Math.max(scaleX, scaleY);

        // 5. è®¾ç½® 'whole_map' å…ƒç´ çš„ç¼©æ”¾å’Œä½ç½®
        map.style.transformOrigin = 'top left';
        map.style.transform = `scale(${scale})`;
        map.style.position = 'absolute';
        map.style.left = -rect.left + 'px';
        map.style.top = -rect.top + 'px';
    }
        positionCharacterInBStart();

  };

  });

// //V11æ–°å¢æ»‘åŠ¨ç‰¹æ•ˆ
// document.addEventListener('click', function(event) {
//   var character = document.getElementById('character'); // è·å–IDä¸º'character'çš„å…ƒç´ 
//   var wholeMap = document.getElementById('whole_map'); // è·å–IDä¸º'whole_map'çš„å…ƒç´ 
//
//   // è®¡ç®—'character'å…ƒç´ çš„æ–°ä½ç½®
//   var newX = event.clientX - character.offsetWidth / 2; // æ–°çš„Xåæ ‡
//   var newY = event.clientY - character.offsetHeight / 2; // æ–°çš„Yåæ ‡
//
//   // å°†'character'å…ƒç´ ç§»åŠ¨åˆ°æ–°ä½ç½®
//   character.style.left = newX + 'px'; // è®¾ç½®æ–°çš„å·¦è¾¹è·
//   character.style.top = newY + 'px'; // è®¾ç½®æ–°çš„é¡¶è¾¹è·
//
//   // ç§»åŠ¨èƒŒæ™¯ä»¥äº§ç”Ÿè§†å·®æ•ˆæœ
//   var backgroundShiftX = -newX; // èƒŒæ™¯Xè½´çš„ç§»åŠ¨é‡
//   var backgroundShiftY = -newY; // èƒŒæ™¯Yè½´çš„ç§»åŠ¨é‡
//
//   wholeMap.style.left = backgroundShiftX + 'px'; // è®¾ç½®èƒŒæ™¯çš„æ–°å·¦è¾¹è·
//   wholeMap.style.top = backgroundShiftY + 'px'; // è®¾ç½®èƒŒæ™¯çš„æ–°é¡¶è¾¹è·
// });

// //V12å°è¯•æ–°çš„å¹³ç§»ï¼ˆç»‘å®šæ ¼å­ï¼‰
// document.addEventListener('click', function(event) {
//   var character = document.getElementById('character'); // Get the 'character' element
//   var gridContainer = document.getElementById('grid-container'); // Get the 'grid-container' element
//
//   // Calculate the new position for the character
//   var newX = event.clientX - character.offsetWidth / 2;
//   var newY = event.clientY - character.offsetHeight / 2;
//
//   // Move the character to the new position
//   character.style.transform = `translate(${newX}px, ${newY}px)`;
//
//   // Move the grid container in the opposite direction
//   gridContainer.style.transform = `translate(${-newX}px, ${-newY}px)`;
// });
// //
// ä½†è¦æ–°å¢<div id="grid-container">
//         <!-- All your grid divs go here -->
//         </div>


</script>

</body>
</html>
